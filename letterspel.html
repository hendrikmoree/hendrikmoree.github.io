<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letterspel voor groep 2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 800px;
            width: 100%;
            padding: 30px;
            text-align: center;
        }

        h1 {
            color: #ff6b6b;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .menu {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .menu-button:hover {
            transform: translateY(-3px);
        }

        .game-area {
            display: none;
            min-height: 400px;
        }

        .game-area.active {
            display: block;
        }

        .letter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .letter-card {
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
            border: 3px solid #e17055;
            border-radius: 15px;
            padding: 20px;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #2d3436;
        }

        .letter-card:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .letter-card.correct {
            background: linear-gradient(45deg, #00b894, #00cec9);
            animation: bounce 0.6s;
        }

        .word-game {
            text-align: center;
        }

        .word-display {
            font-size: 3em;
            color: #2d3436;
            margin: 20px 0;
            font-weight: bold;
        }

        .word-input {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .letter-slot {
            width: 60px;
            height: 60px;
            border: 3px dashed #74b9ff;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            background: #f8f9fa;
        }

        .letter-slot.filled {
            background: #74b9ff;
            color: white;
            border-style: solid;
            cursor: pointer;
            transition: all 0.3s;
        }

        .letter-slot.filled:hover {
            background: #fd79a8;
            transform: scale(1.1);
        }

        .letter-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .letter-option {
            background: linear-gradient(45deg, #a29bfe, #6c5ce7);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .letter-option:hover {
            transform: scale(1.1);
        }

        .letter-option.used {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .back-button {
            background: linear-gradient(45deg, #fd79a8, #e84393);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s;
        }

        .back-button:hover {
            transform: translateY(-2px);
        }

        .score {
            font-size: 1.5em;
            color: #00b894;
            font-weight: bold;
            margin: 20px 0;
        }

        .celebration {
            font-size: 2em;
            color: #00b894;
            margin: 20px 0;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        .alphabet-game {
            text-align: center;
        }

        .current-letter {
            font-size: 8em;
            color: #e17055;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
        }

        .letter-sound {
            background: linear-gradient(45deg, #fd79a8, #fdcb6e);
            color: white;
            border: none;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }

        .letter-sound:hover {
            transform: scale(1.05);
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .menu-button {
                padding: 15px 20px;
                font-size: 1em;
            }

            .current-letter {
                font-size: 6em;
            }

            .letter-card {
                padding: 15px;
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üåü Letterspel voor groep 2 üåü</h1>

        <div id="main-menu" class="menu">
            <div id="audio-init" style="margin-bottom: 20px;">
                <button class="menu-button" onclick="initializeAudio()" style="background: linear-gradient(45deg, #fd79a8, #e84393);">
                    üîä Geluid aanzetten
                </button>
                <button class="menu-button" onclick="debugAudio()" style="background: linear-gradient(45deg, #74b9ff, #0984e3); font-size: 0.9em;">
                    üîç Audio Debug
                </button>
                <div id="audio-status" style="margin-top: 10px; font-size: 0.9em; color: #666;"></div>
                <div id="debug-info" style="margin-top: 10px; font-size: 0.8em; color: #333; max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px; display: none;"></div>
            </div>
            <button class="menu-button" onclick="startAlphabetGame()">
                üî§ Letters leren
            </button>
            <button class="menu-button" onclick="startWordGame()">
                üìñ Woordjes lezen
            </button>
            <button class="menu-button" onclick="startLetterRecognition()">
                üéØ Letters zoeken
            </button>
        </div>

        <!-- Alfabet spel -->
        <div id="alphabet-game" class="game-area alphabet-game">
            <h2>Welke letter is dit?</h2>
            <div class="current-letter" id="current-letter">A</div>
            <button class="letter-sound" onclick="playLetterSound()">üîä Hoe klinkt deze letter?</button>
            <div class="letter-options" id="alphabet-options"></div>
            <div class="score" id="alphabet-score">Score: 0</div>
            <button class="back-button" onclick="goToMenu()">‚Üê Terug naar menu</button>
        </div>

        <!-- Woord spel -->
        <div id="word-game" class="game-area word-game">
            <h2>Maak het woord!</h2>
            <div class="word-display" id="word-display">üê±</div>
            <div class="word-input" id="word-input"></div>
            <div class="letter-options" id="word-options"></div>
            <div class="score" id="word-score">Score: 0</div>
            <button class="back-button" onclick="goToMenu()">‚Üê Terug naar menu</button>
        </div>

        <!-- Letter herkenning spel -->
        <div id="letter-recognition" class="game-area">
            <h2>Zoek de letter: <span id="target-letter">A</span></h2>
            <div class="letter-grid" id="letter-grid"></div>
            <div class="score" id="recognition-score">Score: 0</div>
            <button class="back-button" onclick="goToMenu()">‚Üê Terug naar menu</button>
        </div>
    </div>

    <script>
        // Game state
        let currentGame = null;
        let audioInitialized = false;
        let voicesLoaded = false;
        let availableVoices = [];
        let scores = {
            alphabet: 0,
            word: 0,
            recognition: 0
        };

        // Data
        const alphabet = 'abcdefghijklmnopqrstuvwxyz'.split('');
        const words = [
            { word: 'kat', emoji: 'üê±', sound: 'kat' },
            { word: 'hond', emoji: 'üê∂', sound: 'hond' },
            { word: 'boom', emoji: 'üå≥', sound: 'boom' },
            { word: 'boot', emoji: '‚õµ', sound: 'boot' },
            { word: 'boek', emoji: 'üìö', sound: 'boek' },
            { word: 'bal', emoji: '‚öΩ', sound: 'bal' },
            { word: 'vis', emoji: 'üêü', sound: 'vis' },
            { word: 'pop', emoji: 'ü™Ü', sound: 'pop' },
            { word: 'bed', emoji: 'üõèÔ∏è', sound: 'bed' },
            { word: 'zon', emoji: '‚òÄÔ∏è', sound: 'zon' },
            { word: 'peer', emoji: 'üçê', sound: 'peer' },
            { word: 'maan', emoji: 'üåô', sound: 'maan' },
            { word: 'beer', emoji: 'üêª', sound: 'beer' },
            { word: 'roos', emoji: 'üåπ', sound: 'roos' },
            { word: 'kaas', emoji: 'üßÄ', sound: 'kaas' },
            { word: 'melk', emoji: 'ü•õ', sound: 'melk' },
            { word: 'ei', emoji: 'ü•ö', sound: 'ei' },
            { word: 'koek', emoji: 'üç™', sound: 'koek' },
            { word: 'pen', emoji: 'üñäÔ∏è', sound: 'pen' },
            { word: 'tas', emoji: 'üéí', sound: 'tas' },
            { word: 'pet', emoji: 'üß¢', sound: 'pet' },
            { word: 'sok', emoji: 'ÔøΩÔøΩ', sound: 'sok' },
            { word: 'bril', emoji: 'üëì', sound: 'bril' },
            { word: 'kam', emoji: 'ü™Æ', sound: 'kam' },
            { word: 'zeep', emoji: 'üßº', sound: 'zeep' },
            { word: 'bad', emoji: 'üõÅ', sound: 'bad' },
            { word: 'deur', emoji: 'üö™', sound: 'deur' },
            { word: 'raam', emoji: 'ü™ü', sound: 'raam' },
            { word: 'lamp', emoji: 'üí°', sound: 'lamp' },
            { word: 'klok', emoji: '‚è∞', sound: 'klok' },
            { word: 'mes', emoji: 'üî™', sound: 'mes' },
            { word: 'vork', emoji: 'üç¥', sound: 'vork' },
            { word: 'kom', emoji: 'üçú', sound: 'kom' },
            { word: 'bord', emoji: 'üçΩÔ∏è', sound: 'bord' },
            { word: 'glas', emoji: 'ü•§', sound: 'glas' },
            { word: 'ijs', emoji: 'üç¶', sound: 'ijs' },
            { word: 'spin', emoji: 'üï∑Ô∏è', sound: 'spin' }
        ];

        // Letter sounds (Nederlandse letterklanken)
        const letterSounds = {
            'a': 'ah', 'b': 'buh', 'c': 'c', 'd': 'd', 'e': 'eh',
            'f': 'ef', 'g': 'g', 'h': 'hah', 'i': 'ie', 'j': 'jee',
            'k': 'ka', 'l': 'el', 'm': 'em', 'n': 'en', 'o': 'oh',
            'p': 'pee', 'q': 'kuu', 'r': 'rr', 's': 'es', 't': 'tee',
            'u': 'uu', 'v': 'vee', 'w': 'wee', 'x': 'iks', 'y': 'griekse ei',
            'z': 'zet'
        };

        // Current game variables
        let currentLetter = '';
        let currentWord = null;
        let currentWordInput = [];
        let targetLetter = '';

        // Initialize audio system with multiple fallbacks
        function initializeAudio() {
            debugLog('=== Audio Initialization Started ===');

            // Try multiple approaches
            tryWebSpeechAPI();
        }

        function tryWebSpeechAPI() {
            debugLog('üîç Trying Web Speech API...');

            if (!('speechSynthesis' in window)) {
                debugLog('‚ùå Web Speech API not supported');
                tryAlternativeAPI();
                return;
            }

            debugLog('‚úÖ Web Speech API available');

            // Force load voices
            loadVoicesWithRetry();
        }

        function loadVoicesWithRetry() {
            let attempts = 0;
            const maxAttempts = 10;

            function tryLoadVoices() {
                attempts++;
                debugLog(`üîÑ Loading voices attempt ${attempts}/${maxAttempts}`);

                const voices = speechSynthesis.getVoices();
                debugLog(`üìä Found ${voices.length} voices`);

                if (voices.length > 0) {
                    availableVoices = voices;
                    voicesLoaded = true;
                    debugLog('‚úÖ Voices loaded successfully');
                    testWebSpeechAPI();
                } else if (attempts < maxAttempts) {
                    // Try again after a delay
                    setTimeout(tryLoadVoices, 200);
                } else {
                    debugLog('‚ùå Failed to load voices after multiple attempts');
                    tryAlternativeAPI();
                }
            }

            // Set up voice change listener
            speechSynthesis.onvoiceschanged = function() {
                debugLog('üîÑ Voices changed event fired');
                const voices = speechSynthesis.getVoices();
                if (voices.length > 0) {
                    availableVoices = voices;
                    voicesLoaded = true;
                    debugLog('‚úÖ Voices loaded via event');
                    testWebSpeechAPI();
                }
            };

            // Start trying to load voices
            tryLoadVoices();
        }

        function testWebSpeechAPI() {
            debugLog('üéµ Testing Web Speech API...');

            const testUtterance = new SpeechSynthesisUtterance('Test');
            testUtterance.volume = 0.5;
            testUtterance.rate = 0.8;
            testUtterance.pitch = 1.0;

            // Find best voice
            const bestVoice = findBestVoice();
            if (bestVoice) {
                testUtterance.voice = bestVoice;
                debugLog(`üé§ Using voice: ${bestVoice.name} (${bestVoice.lang})`);
            } else {
                testUtterance.lang = 'nl-NL';
                debugLog('üé§ Using default language: nl-NL');
            }

            testUtterance.onstart = function() {
                audioInitialized = true;
                const msg = '‚úÖ Geluid werkt!';
                document.getElementById('audio-status').textContent = msg;
                debugLog(msg);
            };

            testUtterance.onend = function() {
                debugLog('‚úÖ Test audio completed');
            };

            testUtterance.onerror = function(event) {
                debugLog(`‚ùå Web Speech API error: ${event.error}`);
                tryAlternativeAPI();
            };

            try {
                speechSynthesis.speak(testUtterance);
                debugLog('üì§ Test utterance sent to speechSynthesis');
            } catch (error) {
                debugLog(`‚ùå Error speaking: ${error.message}`);
                tryAlternativeAPI();
            }
        }

        function tryAlternativeAPI() {
            debugLog('üîÑ Trying alternative TTS solution...');

            // Use a different free TTS API
            testVoiceRSSAPI();
        }

        function testVoiceRSSAPI() {
            debugLog('üéµ Testing VoiceRSS API...');

            const testText = 'Test geluid';
            const audioUrl = `https://api.voicerss.org/?key=demo&hl=nl-nl&c=MP3&f=44khz_16bit_stereo&src=${encodeURIComponent(testText)}`;

            const audio = new Audio(audioUrl);

            audio.oncanplaythrough = function() {
                debugLog('‚úÖ VoiceRSS API audio ready');
                audio.play().then(() => {
                    audioInitialized = true;
                    const msg = '‚úÖ Geluid werkt met VoiceRSS!';
                    document.getElementById('audio-status').textContent = msg;
                    debugLog(msg);
                }).catch(error => {
                    debugLog(`‚ùå VoiceRSS playback error: ${error.message}`);
                    trySimpleBeep();
                });
            };

            audio.onerror = function(error) {
                debugLog(`‚ùå VoiceRSS API error: ${error.message || 'Unknown error'}`);
                trySimpleBeep();
            };

            // Load the audio
            audio.load();
        }

        function trySimpleBeep() {
            debugLog('üîî Trying simple beep as last resort...');

            try {
                // Create a simple beep sound using Web Audio API
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = 800;
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);

                audioInitialized = true;
                const msg = '‚úÖ Audio werkt (alleen pieptonen)';
                document.getElementById('audio-status').textContent = msg;
                debugLog(msg);

            } catch (error) {
                debugLog(`‚ùå Even beep failed: ${error.message}`);
                const msg = '‚ùå Audio werkt niet op dit apparaat';
                document.getElementById('audio-status').textContent = msg;
                debugLog(msg);
            }
        }

        function debugAudio() {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.style.display = 'block';
            debugDiv.innerHTML = '<strong>üîç Audio Debug Informatie:</strong><br><br>';

            // Browser info
            debugDiv.innerHTML += `<strong>Browser:</strong> ${navigator.userAgent}<br><br>`;

            // Check all audio capabilities
            debugDiv.innerHTML += '<strong>Audio Capabilities:</strong><br>';
            debugDiv.innerHTML += `speechSynthesis: ${'speechSynthesis' in window ? '‚úÖ' : '‚ùå'}<br>`;
            debugDiv.innerHTML += `AudioContext: ${(window.AudioContext || window.webkitAudioContext) ? '‚úÖ' : '‚ùå'}<br>`;
            debugDiv.innerHTML += `HTML5 Audio: ${typeof Audio !== 'undefined' ? '‚úÖ' : '‚ùå'}<br><br>`;

            // Web Speech API info
            if ('speechSynthesis' in window) {
                const voices = speechSynthesis.getVoices();
                debugDiv.innerHTML += `<strong>Web Speech API Voices:</strong> ${voices.length}<br>`;

                if (voices.length > 0) {
                    const dutchVoices = voices.filter(v => v.lang.startsWith('nl'));
                    debugDiv.innerHTML += `Nederlandse voices: ${dutchVoices.length}<br>`;

                    voices.slice(0, 5).forEach((voice, index) => {
                        debugDiv.innerHTML += `${index + 1}. ${voice.name} (${voice.lang})<br>`;
                    });

                    if (voices.length > 5) {
                        debugDiv.innerHTML += `... en ${voices.length - 5} meer<br>`;
                    }
                }
            }

            debugDiv.innerHTML += '<br><button onclick="forceReloadVoices()" style="padding: 5px 10px; margin: 5px;">üîÑ Herlaad Voices</button>';
            debugDiv.innerHTML += '<button onclick="testAllMethods()" style="padding: 5px 10px; margin: 5px;">üéµ Test Alle Methoden</button>';
        }

        function forceReloadVoices() {
            debugLog('üîÑ Force reloading voices...');
            speechSynthesis.cancel();
            loadVoicesWithRetry();
        }

        function testAllMethods() {
            debugLog('üéµ Testing all audio methods...');

            setTimeout(() => testWebSpeechAPI(), 500);
            setTimeout(() => testVoiceRSSAPI(), 2000);
            setTimeout(() => trySimpleBeep(), 4000);
        }

        function debugLog(message) {
            console.log('[Audio Debug]', message);
            const debugDiv = document.getElementById('debug-info');
            if (debugDiv && debugDiv.style.display !== 'none') {
                debugDiv.innerHTML += message + '<br>';
                debugDiv.scrollTop = debugDiv.scrollHeight;
            }
        }

        function loadVoices() {
            // This is now handled by loadVoicesWithRetry
        }

        function findBestVoice() {
            if (!voicesLoaded || availableVoices.length === 0) {
                return null;
            }

            // Try to find Dutch voice first
            let dutchVoice = availableVoices.find(voice =>
                voice.lang.startsWith('nl') || voice.lang.startsWith('nl-')
            );

            if (dutchVoice) {
                return dutchVoice;
            }

            // Fallback to English
            let englishVoice = availableVoices.find(voice =>
                voice.lang.startsWith('en') || voice.lang.startsWith('en-')
            );

            if (englishVoice) {
                return englishVoice;
            }

            // Use first available voice
            return availableVoices[0];
        }

        function playSound(text) {
            if (!audioInitialized) {
                console.log('Audio not initialized, skipping sound:', text);
                return;
            }

            // Try different methods based on what worked during initialization
            if ('speechSynthesis' in window && voicesLoaded) {
                playSoundWithWebSpeech(text);
            } else {
                playSoundWithAPI(text);
            }
        }

        function playSoundWithWebSpeech(text) {
            try {
                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                const bestVoice = findBestVoice();

                if (bestVoice) {
                    utterance.voice = bestVoice;
                    utterance.lang = bestVoice.lang;
                } else {
                    utterance.lang = 'nl-NL';
                }

                utterance.rate = 0.8;
                utterance.pitch = 1.0;
                utterance.volume = 0.8;

                speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('Error with Web Speech:', error);
                playSoundWithAPI(text);
            }
        }

        function playSoundWithAPI(text) {
            try {
                const audioUrl = `https://api.voicerss.org/?key=demo&hl=nl-nl&c=MP3&f=44khz_16bit_stereo&src=${encodeURIComponent(text)}`;
                const audio = new Audio(audioUrl);

                audio.play().catch(error => {
                    console.error('Error playing API audio:', error);
                    // Last resort: just log the text
                    console.log('Would say:', text);
                });
            } catch (error) {
                console.error('Error with API audio:', error);
            }
        }

        // Utility functions
        function shuffle(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function celebrate() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.innerHTML = 'üéâ Goed gedaan! üéâ';
            document.querySelector('.game-area.active').appendChild(celebration);

            setTimeout(() => {
                celebration.remove();
            }, 2000);

            playSound('Goed gedaan!');
        }

        // Menu functions
        function goToMenu() {
            document.querySelectorAll('.game-area').forEach(area => {
                area.classList.remove('active');
            });
            document.getElementById('main-menu').style.display = 'flex';
        }

        function startGame(gameId) {
            document.getElementById('main-menu').style.display = 'none';
            document.querySelectorAll('.game-area').forEach(area => {
                area.classList.remove('active');
            });
            document.getElementById(gameId).classList.add('active');
        }

        // Alphabet game
        function startAlphabetGame() {
            currentGame = 'alphabet';
            startGame('alphabet-game');
            nextAlphabetQuestion();
        }

        function nextAlphabetQuestion() {
            currentLetter = alphabet[Math.floor(Math.random() * alphabet.length)];
            document.getElementById('current-letter').textContent = currentLetter;

            // Create options
            const options = [currentLetter];
            while (options.length < 4) {
                const randomLetter = alphabet[Math.floor(Math.random() * alphabet.length)];
                if (!options.includes(randomLetter)) {
                    options.push(randomLetter);
                }
            }

            const shuffledOptions = shuffle(options);
            const optionsContainer = document.getElementById('alphabet-options');
            optionsContainer.innerHTML = '';

            shuffledOptions.forEach(letter => {
                const button = document.createElement('button');
                button.className = 'letter-option';
                button.textContent = letter;
                button.onclick = () => checkAlphabetAnswer(letter);
                optionsContainer.appendChild(button);
            });

            playSound(`Welke letter is dit?`);
        }

        function checkAlphabetAnswer(selectedLetter) {
            if (selectedLetter === currentLetter) {
                scores.alphabet++;
                document.getElementById('alphabet-score').textContent = `Score: ${scores.alphabet}`;
                celebrate();
                setTimeout(nextAlphabetQuestion, 2000);
            } else {
                playSound('Probeer het nog eens!');
                // Highlight correct answer
                document.querySelectorAll('#alphabet-options .letter-option').forEach(btn => {
                    if (btn.textContent === currentLetter) {
                        btn.style.background = 'linear-gradient(45deg, #00b894, #00cec9)';
                    }
                });
            }
        }

        function playLetterSound() {
            playSound(letterSounds[currentLetter]);
        }

        // Word game
        function startWordGame() {
            currentGame = 'word';
            startGame('word-game');
            nextWordQuestion();
        }

        function nextWordQuestion() {
            currentWord = words[Math.floor(Math.random() * words.length)];
            currentWordInput = new Array(currentWord.word.length).fill('');

            document.getElementById('word-display').textContent = currentWord.emoji;

            // Create input slots
            const inputContainer = document.getElementById('word-input');
            inputContainer.innerHTML = '';

            currentWord.word.split('').forEach((letter, index) => {
                const slot = document.createElement('div');
                slot.className = 'letter-slot';
                slot.id = `slot-${index}`;
                inputContainer.appendChild(slot);
            });

            // Create letter options
            const wordLetters = currentWord.word.split('');
            const extraLetters = [];

            // Add some random letters
            while (extraLetters.length < 3) {
                const randomLetter = alphabet[Math.floor(Math.random() * alphabet.length)];
                if (!wordLetters.includes(randomLetter) && !extraLetters.includes(randomLetter)) {
                    extraLetters.push(randomLetter);
                }
            }

            const allOptions = shuffle([...wordLetters, ...extraLetters]);
            const optionsContainer = document.getElementById('word-options');
            optionsContainer.innerHTML = '';

            allOptions.forEach(letter => {
                const button = document.createElement('button');
                button.className = 'letter-option';
                button.textContent = letter;
                button.onclick = () => selectWordLetter(letter, button);
                optionsContainer.appendChild(button);
            });

            playSound(`Maak het woord voor ${currentWord.sound}`);
        }

        function selectWordLetter(letter, button) {
            if (button.classList.contains('used')) return;

            // Find next empty slot
            const emptySlotIndex = currentWordInput.findIndex(slot => slot === '');
            if (emptySlotIndex === -1) return;

            currentWordInput[emptySlotIndex] = letter;
            const slotElement = document.getElementById(`slot-${emptySlotIndex}`);
            slotElement.textContent = letter;
            slotElement.classList.add('filled');

            // Maak slot klikbaar om letter weg te halen
            slotElement.onclick = () => removeWordLetter(emptySlotIndex, button);

            button.classList.add('used');

            // Check if word is complete
            if (!currentWordInput.includes('')) {
                checkWordAnswer();
            }
        }

        function removeWordLetter(slotIndex, originalButton) {
            // Verwijder letter uit slot
            currentWordInput[slotIndex] = '';
            const slotElement = document.getElementById(`slot-${slotIndex}`);
            slotElement.textContent = '';
            slotElement.classList.remove('filled');
            slotElement.onclick = null;

            // Maak de letter button weer beschikbaar
            originalButton.classList.remove('used');
        }

        function checkWordAnswer() {
            const userWord = currentWordInput.join('');
            if (userWord === currentWord.word) {
                scores.word++;
                document.getElementById('word-score').textContent = `Score: ${scores.word}`;
                celebrate();
                setTimeout(nextWordQuestion, 2000);
            } else {
                // Geef specifieke feedback
                if (userWord.length < currentWord.word.length) {
                    playSound(`Je woord is te kort! Het woord ${currentWord.sound} heeft ${currentWord.word.length} letters. Probeer nog eens!`);
                } else {
                    // Zelfde lengte maar verkeerde letters
                    playSound(`Bijna goed! Maar dit is niet het woord ${currentWord.sound}. Kijk nog eens goed naar het plaatje en probeer opnieuw!`);
                }

                // Reset the word
                setTimeout(() => {
                    currentWordInput = new Array(currentWord.word.length).fill('');
                    document.querySelectorAll('.letter-slot').forEach(slot => {
                        slot.textContent = '';
                        slot.classList.remove('filled');
                        slot.onclick = null;
                    });
                    document.querySelectorAll('.letter-option').forEach(btn => {
                        btn.classList.remove('used');
                    });
                }, 2500);
            }
        }

        // Letter recognition game
        function startLetterRecognition() {
            currentGame = 'recognition';
            startGame('letter-recognition');
            nextRecognitionQuestion();
        }

        function nextRecognitionQuestion() {
            targetLetter = alphabet[Math.floor(Math.random() * alphabet.length)];
            document.getElementById('target-letter').textContent = targetLetter;

            // Create grid with letters
            const gridLetters = [targetLetter];
            while (gridLetters.length < 12) {
                const randomLetter = alphabet[Math.floor(Math.random() * alphabet.length)];
                gridLetters.push(randomLetter);
            }

            const shuffledGrid = shuffle(gridLetters);
            const gridContainer = document.getElementById('letter-grid');
            gridContainer.innerHTML = '';

            shuffledGrid.forEach(letter => {
                const card = document.createElement('div');
                card.className = 'letter-card';
                card.textContent = letter;
                card.onclick = () => checkRecognitionAnswer(letter, card);
                gridContainer.appendChild(card);
            });

            playSound(`Zoek de letter ${letterSounds[targetLetter]}`);
        }

        function checkRecognitionAnswer(selectedLetter, card) {
            if (selectedLetter === targetLetter) {
                card.classList.add('correct');
                scores.recognition++;
                document.getElementById('recognition-score').textContent = `Score: ${scores.recognition}`;
                celebrate();
                setTimeout(nextRecognitionQuestion, 2000);
            } else {
                playSound('Probeer het nog eens!');
                card.style.background = 'linear-gradient(45deg, #e17055, #d63031)';
                setTimeout(() => {
                    card.style.background = 'linear-gradient(45deg, #ffeaa7, #fab1a0)';
                }, 500);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load voices immediately when page loads
            loadVoices();

            // Show audio initialization button
            document.getElementById('audio-status').textContent = 'Klik op "Geluid aanzetten" om het spel met geluid te spelen';
        });
    </script>
</body>
</html>
</html>